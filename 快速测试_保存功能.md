# 快速测试 - 新保存功能

## 🚀 快速测试步骤

### 方法1：使用测试脚本（推荐）

```bash
python test_save_dialog.py
```

这会打开一个简单的测试图形，你可以：
1. 看到新的预览界面
2. 点击"💾 保存图片"按钮
3. 测试新的保存对话框功能

---

### 方法2：使用主GUI测试

```bash
python test_gui.py
```

然后：
1. 设置好参数（或使用默认值）
2. 点击"预览多图"或"预览单图"
3. 在预览窗口中点击"💾 保存图片"
4. 测试保存对话框

---

## ✅ 测试检查清单

### 基本功能测试
- [ ] 点击"保存图片"按钮，对话框正常弹出
- [ ] 对话框界面显示正常，没有错位
- [ ] 可以选择不同的文件格式（PNG/PDF/JPG/SVG/TIFF）
- [ ] 可以选择不同的DPI（150/300/600/自定义）
- [ ] 自定义DPI输入框可以正常输入
- [ ] 可以勾选/取消勾选"自动裁剪白边"
- [ ] 可以勾选/取消勾选"透明背景"

### 保存功能测试
- [ ] 选择PNG格式，点击"保存"，文件对话框正常弹出
- [ ] 保存PNG文件成功，文件可以正常打开
- [ ] 保存PDF文件成功，文件可以正常打开
- [ ] 保存JPG文件成功，文件可以正常打开
- [ ] 保存SVG文件成功，文件可以正常打开
- [ ] 保存TIFF文件成功，文件可以正常打开

### DPI测试
- [ ] 150 DPI保存成功，文件大小合理
- [ ] 300 DPI保存成功，文件大小合理
- [ ] 600 DPI保存成功，文件大小合理
- [ ] 自定义DPI（如450）保存成功
- [ ] 输入无效DPI（如50以下或1200以上）会提示错误

### 选项测试
- [ ] 勾选"自动裁剪白边"，保存的图片没有多余空白
- [ ] 取消"自动裁剪白边"，保存的图片保留原始大小
- [ ] PNG格式勾选"透明背景"，保存的图片背景透明
- [ ] SVG格式勾选"透明背景"，保存的图片背景透明
- [ ] JPG格式"透明背景"选项不生效（JPG不支持透明）

### 用户体验测试
- [ ] 保存成功后显示成功提示框
- [ ] 提示框显示保存路径、格式、DPI信息
- [ ] 状态栏显示"图片已保存: xxx.png"
- [ ] 点击"取消"按钮，对话框正常关闭
- [ ] 保存失败时显示错误提示

---

## 🎯 重点测试场景

### 场景1：论文投稿
```
格式：PDF
DPI：300
自动裁剪白边：勾选
透明背景：不勾选
```
**预期结果**：生成高质量PDF文件，适合论文投稿

### 场景2：PPT演示
```
格式：PNG
DPI：150
自动裁剪白边：勾选
透明背景：勾选
```
**预期结果**：生成透明背景PNG文件，适合PPT使用

### 场景3：高质量打印
```
格式：PDF
DPI：600
自动裁剪白边：勾选
透明背景：不勾选
```
**预期结果**：生成高分辨率PDF文件，适合专业打印

### 场景4：网页使用
```
格式：JPG
DPI：150
自动裁剪白边：勾选
透明背景：不勾选
```
**预期结果**：生成小文件JPG，适合网页展示

---

## 🐛 已知问题检查

### 检查1：PNG警告
保存PNG文件时，**不应该**出现以下警告：
```
libpng warning: iCCP: known incorrect sRGB profile
```
✅ 已修复：通过 `pil_kwargs={'icc_profile': None}` 禁用iCCP

### 检查2：文件大小
不同DPI的文件大小应该有明显差异：
- 150 DPI < 300 DPI < 600 DPI
- JPG < PNG < TIFF

### 检查3：透明背景
PNG/SVG格式勾选透明背景后：
- 在图片查看器中应该看到透明背景（通常显示为棋盘格）
- JPG/PDF/TIFF格式不支持透明背景

---

## 📊 测试结果记录

### 测试环境
- 操作系统：Windows / macOS / Linux
- Python版本：
- Matplotlib版本：
- 测试日期：

### 测试结果
| 测试项 | 结果 | 备注 |
|--------|------|------|
| 对话框显示 | ✅/❌ | |
| PNG保存 | ✅/❌ | |
| PDF保存 | ✅/❌ | |
| JPG保存 | ✅/❌ | |
| SVG保存 | ✅/❌ | |
| TIFF保存 | ✅/❌ | |
| DPI设置 | ✅/❌ | |
| 自动裁剪 | ✅/❌ | |
| 透明背景 | ✅/❌ | |
| 错误处理 | ✅/❌ | |

---

## 💡 测试技巧

### 技巧1：快速对比
保存同一张图片的不同格式/DPI版本，对比：
- 文件大小
- 图片质量
- 加载速度

### 技巧2：边界测试
测试极端情况：
- 最小DPI（50）
- 最大DPI（1200）
- 无效DPI（如0、-1、10000）

### 技巧3：格式兼容性
在不同软件中打开保存的文件：
- 图片查看器
- Word/PowerPoint
- Photoshop/Illustrator
- 浏览器

---

## 🔍 问题排查

### 问题1：对话框无法打开
**可能原因**：
- tkinter版本问题
- 窗口管理器问题

**解决方法**：
```python
# 检查tkinter版本
import tkinter as tk
print(tk.TkVersion)
```

### 问题2：保存失败
**可能原因**：
- 文件路径包含特殊字符
- 磁盘空间不足
- 权限问题

**解决方法**：
- 检查错误提示信息
- 尝试保存到其他位置
- 检查磁盘空间

### 问题3：图片质量不佳
**可能原因**：
- DPI设置过低
- 格式选择不当（如JPG有损压缩）

**解决方法**：
- 提高DPI（如从150提高到300）
- 使用无损格式（PNG/PDF/TIFF）

---

## ✅ 测试完成确认

完成所有测试后，确认：
- [ ] 所有基本功能正常工作
- [ ] 所有文件格式都能正常保存
- [ ] DPI设置生效
- [ ] 选项功能正常
- [ ] 错误处理正确
- [ ] 用户体验良好

**测试通过！** 🎉

---

## 📝 反馈

如果发现任何问题，请记录：
1. 问题描述
2. 复现步骤
3. 错误信息
4. 测试环境

这将帮助快速定位和修复问题。

