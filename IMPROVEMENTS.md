# 论文制图工具 - 优化说明

## 版本信息
- **优化版本**: v13
- **优化日期**: 2025-10-29
- **优化内容**: 添加色带宽度调整功能 + 界面优化

---

## 主要改进

### 1. 色带宽度调整功能 ✨

#### 单图页面
在"色带（单图）"区域新增了**宽度比例**参数：
- **位置**: 第一行，位置选择器之后
- **参数名**: 宽度比例
- **默认值**: 0.15
- **取值范围**: 0.05 - 0.3
- **说明**: 控制色带占整个图的宽度比例，数值越大色带越宽

**使用方法**:
1. 在"色带（单图）"区域找到"宽度比例"输入框
2. 输入0.05到0.3之间的数值（推荐0.10-0.20）
3. 预览或导出时会应用该宽度设置

#### 多图页面
优化了"色带选项"区域的布局：

**共享色带**:
- 标签从"厚度占比"改为"宽度比例"
- 默认值: 0.10
- 取值范围: 0.05 - 0.2
- 添加了工具提示说明

**分图色带**:
- 标签从"厚度%"改为"宽度比例"
- 默认值: 0.15
- 取值范围: 0.05 - 0.3
- 添加了工具提示说明

### 2. 界面布局优化 🎨

#### 参数组织优化
- **单图色带区域**: 重新组织了参数布局，使相关参数更加集中
  - 第一行: 位置、宽度比例、与图距、标签文本
  - 第二行: 标签字号、刻度字号、色阶上限

- **多图色带区域**: 优化了共享和分图色带的参数排列
  - 共享色带: 位置、宽度比例、刻度数、标签文本、字号设置、色阶上限
  - 分图色带: 位置、宽度比例、与图距、上限百分位、刻度个数

#### 工具提示增强
添加了"？"提示图标，鼠标悬停可查看参数说明：
- 单图色带宽度比例提示
- 多图共享色带宽度比例提示
- 多图分图色带宽度比例提示

### 3. 新增组件 🔧

#### CollapsibleFrame（折叠面板）
在 `gui_widgets.py` 中新增了可折叠面板组件：
- **功能**: 可以折叠/展开的面板容器
- **用途**: 未来可用于组织复杂的参数区域
- **特性**: 
  - 支持默认展开/折叠状态
  - 带有▼/▶折叠指示器
  - 标题加粗显示

---

## 技术实现

### 修改的文件

1. **gui_widgets.py**
   - 新增 `CollapsibleFrame` 类
   - 为未来的界面优化提供基础组件

2. **plotting.py**
   - 更新 `_make_single_map_impl` 函数签名，添加 `cbar_fraction` 参数
   - 在色带创建时使用 `fraction` 参数控制宽度

3. **gui_app.py**
   - 单图页面: 
     - 将 `e_cbw` 替换为 `e_cbfrac1`
     - 更新预览和导出函数调用
     - 更新参数注册和默认值
   - 多图页面:
     - 将 `e_per_size` 替换为 `e_per_frac`
     - 优化色带选项区域布局
     - 添加工具提示
     - 更新参数注册和默认值

### 参数映射

| 旧参数名 | 新参数名 | 说明 |
|---------|---------|------|
| `e_cbw` | `e_cbfrac1` | 单图色带宽度（从百分比改为比例） |
| `e_per_size` | `e_per_frac` | 多图分图色带宽度（从百分比改为比例） |
| `cbar_size` | `cbar_fraction` | 绘图函数参数（内部转换） |

---

## 兼容性说明

### 完全兼容 ✅
- 所有原有功能保持不变
- 状态文件自动迁移（旧参数名会被新参数名替换）
- 导出的图片质量和效果不受影响

### 默认值调整
- 单图色带宽度: 从 1.6% 改为 0.15（比例值）
- 多图分图色带宽度: 从 1.6% 改为 0.15（比例值）
- 多图共享色带宽度: 保持 0.10 不变

**注意**: 新的比例值与旧的百分比值在视觉效果上基本一致，只是表示方式更加直观。

---

## 使用建议

### 色带宽度设置建议

#### 单图
- **窄色带** (0.08-0.12): 适合图片较小或需要突出主图的情况
- **标准色带** (0.13-0.17): 推荐使用，平衡美观和信息展示
- **宽色带** (0.18-0.25): 适合需要详细展示色阶信息的情况

#### 多图共享色带
- **窄色带** (0.05-0.08): 适合子图较多的情况
- **标准色带** (0.09-0.12): 推荐使用
- **宽色带** (0.13-0.15): 适合子图较少且需要突出色带的情况

#### 多图分图色带
- **窄色带** (0.08-0.12): 适合子图密集排列
- **标准色带** (0.13-0.17): 推荐使用
- **宽色带** (0.18-0.22): 适合子图间距较大的情况

---

## 测试方法

运行测试脚本:
```bash
python test_gui.py
```

或直接运行:
```python
from paper_map.gui_app import run_app
run_app()
```

---

## 未来计划

1. **使用折叠面板重构界面** 📋
   - 将复杂的参数区域组织到可折叠面板中
   - 默认只显示常用参数，高级参数可折叠
   - 进一步简化界面，提升用户体验

2. **参数预设功能** 💾
   - 保存常用的参数组合
   - 快速切换不同的制图风格
   - 导入/导出参数配置文件

3. **实时预览优化** ⚡
   - 参数调整时自动更新预览
   - 减少手动点击预览按钮的次数
   - 提供预览质量选项（快速/高质量）

---

## 反馈与支持

如有问题或建议，请通过以下方式反馈：
- 在代码中添加注释说明问题
- 记录使用过程中的不便之处
- 提出改进建议

---

**祝您使用愉快！** 🎉

