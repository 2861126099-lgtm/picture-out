# 新功能测试指南

## ✅ 问题已修复

之前的"自动布局"按钮报错问题已经修复，现在可以正常使用了。

---

## 🧪 测试步骤

### 1. 启动程序

```bash
python test_gui.py
```

程序应该正常启动，不会报错。

---

### 2. 测试自动布局功能

1. 打开"多图"标签页
2. 在"布局与说明"区域：
   - 行×列：输入 `1` 和 `4`（测试1×4横向布局）
3. 点击 **"自动布局"** 按钮
4. 观察：
   - wspace应该自动变为 `0.02`
   - hspace应该自动变为 `0.22`

**测试不同布局**：
- 2×4：wspace=0.02, hspace=0.18
- 3×4：wspace=0.02, hspace=0.12
- 2×2：wspace=0.08, hspace=0.18

---

### 3. 测试线段式比例尺

1. 在"子图元素（比例尺 & 北箭）"区域
2. 找到"样式"下拉框
3. 选择 **"线段式"**
4. 设置其他比例尺参数（长度、字号等）
5. 点击"预览多图"查看效果

**对比**：
- 分段式：传统的棋盘格样式
- 线段式：简洁的线段样式

---

### 4. 测试共享比例尺

1. 在"子图元素（比例尺 & 北箭）"区域
2. ✓ 勾选 **"使用共享比例尺"**
3. 点击"预览多图"
4. 观察：只有最后一个子图（右下角）显示比例尺

**取消勾选**：
- 每个子图都会显示自己的比例尺

---

### 5. 完整测试：1×4横向布局

这是最常用的场景，测试所有新功能：

**步骤**：

1. **设置布局**
   - 行×列：`1` × `4`
   - 点击"自动布局"按钮
   - 确认 wspace=0.02, hspace=0.22

2. **设置比例尺**
   - 样式：选择"线段式"
   - ✓ 勾选"使用共享比例尺"
   - 长度：留空（自动）或输入具体值
   - 字号：9

3. **设置色带**（可选）
   - ✓ 勾选"使用共享色带"
   - 位置：bottom
   - 宽度比例：0.10

4. **预览**
   - 预览宽×高：15 × 6
   - 点击"预览多图"

**预期效果**：
- 4个子图横向排列
- 间距很小，图片铺满
- 只在最后一个子图显示比例尺
- 比例尺是简洁的线段式
- 如果启用了共享色带，色带在底部

---

## 🎯 功能清单

### ✅ 已完成的功能

1. **统一比例尺**
   - ✅ 添加"使用共享比例尺"复选框
   - ✅ 只在最后一个子图显示
   - ✅ 解决横向排列多时的遮盖问题

2. **线段式比例尺**
   - ✅ 添加"样式"下拉框
   - ✅ 提供"分段式"和"线段式"两种选择
   - ✅ 线段式更简洁，占用空间小

3. **自动布局优化**
   - ✅ 添加"自动布局"按钮
   - ✅ 根据行列数智能计算间距
   - ✅ 特别优化横向排列多的情况
   - ✅ **已修复报错问题**

4. **预览窗口优化**
   - ✅ 改善窗口调整体验
   - ✅ 支持宽度大于高度的预览

---

## 🐛 已修复的问题

### 问题：自动布局按钮报错

**错误信息**：
```
name 'cb_cbloc' is not defined
```

**原因**：
- 变量名错误，应该是 `cb_loc2` 而不是 `cb_cbloc`
- 函数定义位置不对，在变量定义之前

**解决方案**：
- ✅ 修正变量名为 `cb_loc2`
- ✅ 将函数定义移到所有相关变量之后
- ✅ 使用 lambda 延迟调用

---

## 📊 推荐配置

### 1×4 横向布局（最常用）

```
布局：
  行×列：1×4
  wspace：0.02（点击"自动布局"）
  hspace：0.22（点击"自动布局"）

比例尺：
  样式：线段式
  ✓ 使用共享比例尺
  长度：自动或手动
  字号：9

色带：
  ✓ 使用共享色带
  位置：bottom
  宽度比例：0.10

预览：
  宽×高：15×6
  DPI：130
```

### 2×4 布局

```
布局：
  行×列：2×4
  wspace：0.02（点击"自动布局"）
  hspace：0.18（点击"自动布局"）

比例尺：
  样式：线段式
  ✓ 使用共享比例尺
  长度：自动或手动
  字号：9

色带：
  ✓ 使用共享色带
  位置：right
  宽度比例：0.10

预览：
  宽×高：15×8
  DPI：130
```

### 3×4 布局

```
布局：
  行×列：3×4
  wspace：0.02（点击"自动布局"）
  hspace：0.12（点击"自动布局"）

比例尺：
  样式：线段式
  ✓ 使用共享比例尺
  长度：自动或手动
  字号：8

色带：
  ✓ 使用共享色带
  位置：right
  宽度比例：0.08

预览：
  宽×高：15×11
  DPI：130
```

---

## ✅ 验证清单

测试时请确认以下各项：

- [ ] GUI成功启动，无报错
- [ ] "自动布局"按钮可以点击，不报错
- [ ] 点击后wspace和hspace自动填充
- [ ] "样式"下拉框可以选择"分段式"或"线段式"
- [ ] "使用共享比例尺"复选框可以勾选/取消
- [ ] 预览时只在最后一个子图显示比例尺（勾选共享时）
- [ ] 预览时每个子图都显示比例尺（取消共享时）
- [ ] 线段式比例尺显示正常
- [ ] 预览窗口可以正常调整大小
- [ ] 所有原有功能正常工作

---

## 🎉 总结

所有功能已经完成并修复：

1. ✅ 统一比例尺功能 - 正常工作
2. ✅ 线段式比例尺样式 - 正常工作
3. ✅ 自动布局优化 - **已修复报错，正常工作**
4. ✅ 预览窗口优化 - 正常工作

**现在可以正常使用所有新功能了！**

如有任何问题，请随时反馈。

