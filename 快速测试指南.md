# 快速测试指南 - 新版本功能验证

## 🎯 测试目标

验证以下新功能：
1. ✅ 留白进一步减少
2. ✅ 图片清晰度提升（DPI 150）
3. ✅ 共享北箭功能
4. ✅ 标尺式比例尺
5. ✅ 箭头式北箭
6. ✅ GUI布局优化

---

## 📋 测试步骤

### 测试1：验证GUI布局优化

**目标**：确认共享选项已移到顶部

**步骤**：
1. GUI已经启动
2. 切换到 **"多图"** 标签页
3. 找到 **"子图元素（比例尺 & 北箭）"** 区域

**预期结果**：
- ✅ 第一行应该是：
  ```
  ✓ 使用共享比例尺 | ✓ 使用共享北箭 | （提示文字）
  ```
- ✅ 下面才是比例尺参数
- ✅ 比例尺样式下拉框应该有三个选项：**分段式、线段式、标尺式**
- ✅ 北箭样式下拉框应该有两个选项：**三角形、箭头式**

---

### 测试2：验证自动布局和DPI提升

**目标**：确认自动布局使用新DPI，预览尺寸正确

**步骤**：
1. 在"多图"页
2. 设置布局：
   - 行数：`1`
   - 列数：`4`
3. 点击 **"自动布局"** 按钮

**预期结果**：
- ✅ 弹出对话框显示优化结果
- ✅ 预览尺寸应该约为 **2100 × 650 像素**（使用DPI 150）
- ✅ 不应该是18×7这样的错误值
- ✅ wspace应该约为 `0.020`
- ✅ hspace应该约为 `0.250`

**验证DPI**：
- ✅ 在"预览 / 导出"区域，DPI默认值应该是 **150**（不是130）

---

### 测试3：验证共享北箭功能（需要数据文件）

**目标**：确认共享北箭只在最后一个子图显示

**前提条件**：
- 需要4个TIF文件
- 需要1个边界SHP文件

**步骤**：
1. 在"多图"页
2. 设置布局：`1` × `4`
3. 选择4个TIF文件（在TIF列表中）
4. 选择边界SHP文件
5. 在"子图元素"区域：
   - ✓ 勾选 **"使用共享北箭"**
   - 北箭样式：选择 **"箭头式"**
6. 点击 **"预览多图"**

**预期结果**：
- ✅ 只有最后一个子图（第4个）显示北箭
- ✅ 北箭在右上角
- ✅ 北箭是简洁的箭头样式（不是三角形）
- ✅ 前3个子图没有北箭

---

### 测试4：验证标尺式比例尺（需要数据文件）

**目标**：确认标尺式比例尺显示正确

**步骤**：
1. 在"多图"页
2. 使用测试3的设置
3. 在"子图元素"区域：
   - ✓ 勾选 **"使用共享比例尺"**
   - 比例尺样式：选择 **"标尺式"**
4. 点击 **"预览多图"**

**预期结果**：
- ✅ 只有最后一个子图（第4个）显示比例尺
- ✅ 比例尺是标尺式样式：
  ```
  0    50   100   150   200 km
  ├────┼────┼─────┼─────┤
  ```
- ✅ 有多个刻度标记（不是只有两端）
- ✅ 前3个子图没有比例尺

---

### 测试5：验证留白减少（需要数据文件）

**目标**：确认留白明显减少，图片铺满画布

**步骤**：
1. 使用测试3和测试4的设置
2. 额外设置：
   - ✓ 勾选 **"使用共享色带"**
   - 色带位置：**bottom**
3. 点击 **"预览多图"**

**预期结果**：
- ✅ 上部留白很小（约3%）
- ✅ 左右留白很小（约2%）
- ✅ 子图占据大部分画布空间
- ✅ 4个子图横向紧密排列
- ✅ 色带在底部，有合适的空间
- ✅ 比例尺和北箭在最后一个子图，不重叠

**对比检查**：
- ❌ 不应该有大片空白区域
- ❌ 子图不应该挤在画布中间
- ❌ 元素不应该重叠

---

### 测试6：验证清晰度提升（需要数据文件）

**目标**：确认图片清晰度提升

**步骤**：
1. 使用测试5的设置
2. 确认DPI为 **150**
3. 点击 **"预览多图"**
4. 放大预览窗口查看细节

**预期结果**：
- ✅ 文字清晰，不模糊
- ✅ 边界线条清晰
- ✅ 色带过渡平滑
- ✅ 整体图片质量高

**对比**：
- 如果之前DPI是130，现在应该明显更清晰

---

### 测试7：验证样式组合

**目标**：测试不同样式组合

**测试组合1**：学术论文风格
- 比例尺样式：**标尺式**
- 北箭样式：**箭头式**
- ✓ 使用共享比例尺
- ✓ 使用共享北箭

**测试组合2**：传统风格
- 比例尺样式：**分段式**
- 北箭样式：**三角形**
- ✓ 使用共享比例尺
- ✓ 使用共享北箭

**测试组合3**：简洁风格
- 比例尺样式：**线段式**
- 北箭样式：**箭头式**
- ✓ 使用共享比例尺
- ✓ 使用共享北箭

**预期结果**：
- ✅ 所有组合都能正常工作
- ✅ 样式切换正确
- ✅ 没有报错

---

## 🔍 问题排查

### 如果GUI布局没有变化

**可能原因**：
- 代码没有正确加载

**解决方法**：
1. 关闭GUI
2. 重新运行：`python test_gui.py`
3. 检查是否有错误信息

### 如果样式下拉框没有新选项

**检查**：
- 比例尺样式应该有：分段式、线段式、**标尺式**
- 北箭样式应该有：**三角形**、**箭头式**

**如果没有**：
- 检查 `gui_app.py` 第846行和第865行

### 如果预览尺寸仍然错误

**检查**：
- 点击"自动布局"后，预览尺寸应该是正常值（如2100×650）
- 不应该是18×7这样的小值

**如果仍然错误**：
- 检查 `plotting.py` 第266-270行的预览尺寸计算

### 如果留白没有减少

**检查**：
- 预览图片时，观察上下左右的留白
- 应该很小（约2-3%）

**如果留白仍然很大**：
- 检查 `plotting.py` 第642-671行的GridSpec边距设置

---

## 📊 验收标准

### 必须通过的测试

- [ ] **测试1**：GUI布局优化 ✅
- [ ] **测试2**：自动布局和DPI提升 ✅
- [ ] **测试6**：清晰度提升 ✅

### 需要数据文件的测试

如果有数据文件，必须通过：
- [ ] **测试3**：共享北箭功能 ✅
- [ ] **测试4**：标尺式比例尺 ✅
- [ ] **测试5**：留白减少 ✅
- [ ] **测试7**：样式组合 ✅

---

## 🎯 快速验证（无需数据文件）

如果没有数据文件，可以快速验证以下内容：

### 1. GUI布局
- ✅ 共享选项在顶部
- ✅ 样式下拉框有新选项

### 2. 自动布局
- ✅ 点击"自动布局"有反馈
- ✅ 预览尺寸正确（不是18×7）

### 3. 默认DPI
- ✅ DPI默认值是150

**这些都可以在GUI中直接看到，无需预览！**

---

## 📝 测试记录

### 测试环境
- 操作系统：Windows
- Python版本：_______
- 测试日期：_______

### 测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 测试1：GUI布局优化 | ⬜ 通过 / ⬜ 失败 | |
| 测试2：自动布局和DPI | ⬜ 通过 / ⬜ 失败 | |
| 测试3：共享北箭 | ⬜ 通过 / ⬜ 失败 / ⬜ 跳过 | |
| 测试4：标尺式比例尺 | ⬜ 通过 / ⬜ 失败 / ⬜ 跳过 | |
| 测试5：留白减少 | ⬜ 通过 / ⬜ 失败 / ⬜ 跳过 | |
| 测试6：清晰度提升 | ⬜ 通过 / ⬜ 失败 / ⬜ 跳过 | |
| 测试7：样式组合 | ⬜ 通过 / ⬜ 失败 / ⬜ 跳过 | |

### 发现的问题

1. _______________________________________
2. _______________________________________
3. _______________________________________

---

## 🎉 测试完成

如果所有测试通过，说明新版本功能正常！

**下一步**：
1. 使用实际数据测试完整流程
2. 导出高质量图片
3. 根据需要微调参数

**如有问题**：
1. 记录具体现象
2. 提供参数设置
3. 附上截图（如果可能）

祝测试顺利！🎊

