# 新预览界面使用指南

## 🎯 快速开始

### 启动测试
```bash
# 测试新界面功能
python test_new_interface.py

# 或使用主GUI
python test_gui.py
```

---

## 📱 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  交互式预览 - 使用方向键或按钮调整位置                        │
├──────────────────────────┬──────────────────────────────────┤
│                          │  位置微调控制                     │
│                          │                                   │
│                          │  ┌─ 调整对象 ─────────────────┐  │
│                          │  │ ○ 🎨 色带位置              │  │
│      图形显示区域         │  │ ● 📏 比例尺位置            │  │
│                          │  │ ○ 🧭 北箭位置              │  │
│                          │  └────────────────────────────┘  │
│                          │                                   │
│                          │  ┌─ 方向控制 ─────────────────┐  │
│                          │  │ 步长: ○小 ●中 ○大         │  │
│                          │  │                             │  │
│                          │  │        ▲                    │  │
│                          │  │    ◀   ●   ▶                │  │
│                          │  │        ▼                    │  │
│                          │  │                             │  │
│                          │  │ ✓ 比例尺向上移动            │  │
│                          │  └────────────────────────────┘  │
│                          │                                   │
│                          │  ┌─ 视图控制 ─────────────────┐  │
│                          │  │ ☑ 🔒 锁定视图（防止缩放）  │  │
│                          │  │ [🔄 恢复视图]              │  │
│                          │  │ 视图状态: 已锁定            │  │
│                          │  └────────────────────────────┘  │
│                          │                                   │
│                          │  ┌─ 当前偏移量 ───────────────┐  │
│                          │  │ cbar_offset_y: 0.000       │  │
│                          │  │ cbar_offset_x: 0.000       │  │
│                          │  │ scale_offset_x: 0.015      │  │
│                          │  │ scale_offset_y: 0.020      │  │
│                          │  │ north_offset_x: 0.000      │  │
│                          │  │ north_offset_y: 0.000      │  │
│                          │  └────────────────────────────┘  │
│                          │                                   │
│                          │  [💾 保存图片]                    │
│                          │  [💾 保存位置设置]                │
│                          │  [🔄 重置所有位置]                │
│                          │  [❌ 关闭]                        │
├──────────────────────────┴──────────────────────────────────┤
│  当前调整: 📏 比例尺 | 视图锁定: 开启                        │
└─────────────────────────────────────────────────────────────┘
```

---

## 🎮 操作方法

### 方法1：使用方向按钮（推荐新手）

#### 步骤1：选择调整对象
点击以下之一：
- 🎨 **色带位置** - 调整色带（colorbar）的位置
- 📏 **比例尺位置** - 调整比例尺的位置
- 🧭 **北箭位置** - 调整北箭的位置

**反馈**：会显示"已切换到 xxx"

#### 步骤2：选择步长
- **小**（0.005）- 精细调整，适合微调
- **中**（0.01）- 默认步长，适合大多数情况
- **大**（0.05）- 快速移动，适合大幅调整

#### 步骤3：点击方向按钮
- **▲** - 向上移动
- **▼** - 向下移动
- **◀** - 向左移动
- **▶** - 向右移动
- **●** - 重置当前对象到初始位置

**反馈**：会显示"✓ xxx向x移动 (步长: 0.xxx)"

#### 步骤4：观察效果
- 图形会实时更新
- 偏移量会实时显示
- 反馈区域会显示操作结果

---

### 方法2：使用键盘（推荐熟练用户）

#### 基本操作
| 按键 | 功能 | 反馈 |
|------|------|------|
| Tab | 切换调整对象 | 已切换到 xxx |
| ↑ | 向上移动（中等步长） | ✓ xxx向上移动 |
| ↓ | 向下移动（中等步长） | ✓ xxx向下移动 |
| ← | 向左移动（中等步长） | ✓ xxx向左移动 |
| → | 向右移动（中等步长） | ✓ xxx向右移动 |

#### 高级操作
| 按键 | 功能 | 反馈 |
|------|------|------|
| Shift+↑↓←→ | 大幅移动（大步长） | ✓ xxx向x移动 (步长大) |
| R | 重置当前对象 | ✓ 已重置xxx位置 |
| Ctrl+R | 重置所有对象 | ✓ 已重置所有位置 |
| S | 保存位置设置 | ✓ 位置设置已保存 |
| H | 显示帮助 | 弹出帮助对话框 |

---

## 🔒 视图控制

### 问题：为什么需要视图锁定？

在使用方向键调整位置时，matplotlib可能会误认为你在进行导航操作（缩放/平移），导致图形突然放大或缩小。

### 解决方案：视图锁定系统

#### 自动锁定
- **默认开启**：视图锁定默认开启
- **自动检查**：每100ms自动检查视图是否改变
- **自动恢复**：如果视图改变，自动恢复到初始状态

#### 手动控制
1. **锁定视图**：勾选"🔒 锁定视图（防止缩放）"
2. **解锁视图**：取消勾选（不推荐）
3. **恢复视图**：点击"🔄 恢复视图"按钮

#### 视图状态
- **已锁定**（绿色）：视图被锁定，不会缩放
- **未锁定**（橙色）：视图未锁定，可能会缩放
- **已恢复**（绿色）：视图已恢复到初始状态

---

## 💬 操作反馈系统

### 反馈类型

#### 成功（绿色 ✓）
```
✓ 色带向上移动 (步长: 0.010)
✓ 已重置比例尺位置
✓ 位置设置已保存
✓ 视图已恢复到初始状态
```

#### 失败（红色 ✗）
```
✗ 移动失败
✗ 更新失败: xxx
✗ 恢复视图失败: xxx
```

#### 警告（橙色 ⚠）
```
⚠ 没有可恢复的视图
```

#### 信息（蓝色）
```
已切换到 🎨 色带
视图锁定已开启
等待操作...
```

### 反馈位置
1. **方向控制区域**：显示移动操作的反馈
2. **状态栏**：显示当前模式和视图状态
3. **视图控制区域**：显示视图状态

---

## 📋 完整工作流程

### 场景1：调整色带位置

```
1. 点击"🎨 色带位置"
   → 反馈："已切换到 🎨 色带"

2. 选择步长"中"

3. 点击"▲"按钮3次
   → 反馈："✓ 色带向上移动 (步长: 0.010)"
   → 图形实时更新

4. 点击"◀"按钮2次
   → 反馈："✓ 色带向左移动 (步长: 0.010)"

5. 满意后，点击"💾 保存位置设置"
   → 反馈："✓ 位置设置已保存"
   → 弹出确认对话框

6. 点击"💾 保存图片"
   → 选择格式和DPI
   → 保存图片
```

### 场景2：处理视图缩放

```
问题：使用方向键时，图片突然放大了！

解决步骤：
1. 立即点击"🔄 恢复视图"
   → 反馈："✓ 视图已恢复到初始状态"
   → 图形恢复正常

2. 检查"🔒 锁定视图"是否勾选
   → 如果未勾选，勾选它
   → 反馈："✓ 视图锁定已开启"

3. 继续调整位置
   → 不会再出现缩放问题
```

### 场景3：精细调整

```
1. 选择调整对象（如：📏 比例尺位置）

2. 选择步长"大"，快速移动到大致位置
   → 点击"▲"几次

3. 选择步长"小"，进行精细调整
   → 点击"▲"或"▼"微调

4. 观察偏移量数值
   → scale_offset_y: 0.025

5. 满意后保存
```

---

## 🔍 常见问题

### Q1: 点击方向按钮没反应？

**检查清单**：
- [ ] 是否选择了调整对象？
- [ ] 查看反馈区域的提示
- [ ] 是否有错误信息？

**解决方法**：
1. 确保选中了一个调整对象（色带/比例尺/北箭）
2. 查看反馈信息了解具体问题
3. 如果显示"✗ 移动失败"，尝试重启预览窗口

---

### Q2: 图片还是会缩放？

**检查清单**：
- [ ] "锁定视图"是否勾选？
- [ ] 视图状态显示什么？

**解决方法**：
1. 勾选"🔒 锁定视图"
2. 点击"🔄 恢复视图"
3. 如果问题持续，关闭预览窗口重新打开

---

### Q3: 如何知道调整了多少？

**查看方法**：
1. **偏移量显示区域**：显示精确数值
   ```
   scale_offset_x: 0.015
   scale_offset_y: 0.020
   ```

2. **反馈信息**：显示每次移动的步长
   ```
   ✓ 比例尺向上移动 (步长: 0.010)
   ```

---

### Q4: 如何撤销调整？

**方法1：重置当前对象**
- 点击中心按钮（●）
- 或按 R 键
- 反馈："✓ 已重置xxx位置"

**方法2：重置所有对象**
- 点击"🔄 重置所有位置"
- 或按 Ctrl+R
- 反馈："✓ 已重置所有位置"

**方法3：恢复上次保存的位置**
- 关闭预览窗口
- 重新打开
- 会自动加载上次保存的位置

---

### Q5: 保存的位置在哪里？

**位置文件**：`position_adjustments.json`

**内容示例**：
```json
{
  "cbar_offset_y": 0.0,
  "cbar_offset_x": 0.0,
  "scale_offset_x": 0.015,
  "scale_offset_y": 0.020,
  "north_offset_x": 0.0,
  "north_offset_y": 0.0
}
```

**使用**：
- 下次打开预览窗口时自动加载
- 可以手动编辑此文件
- 可以备份此文件

---

## 💡 使用技巧

### 技巧1：组合使用按钮和键盘
```
1. 用按钮快速移动到大致位置（步长"大"）
2. 用键盘精细调整（Shift+方向键或普通方向键）
3. 观察反馈信息确认每次调整
```

### 技巧2：利用反馈信息
```
反馈信息会显示：
- 调整的对象（色带/比例尺/北箭）
- 移动的方向（上/下/左/右）
- 使用的步长（0.005/0.01/0.05）

根据这些信息可以精确控制调整
```

### 技巧3：保持视图锁定开启
```
建议：
- 始终保持"锁定视图"勾选
- 这样可以避免99%的缩放问题
- 如果需要查看细节，可以临时取消勾选
```

### 技巧4：定期保存位置
```
建议：
- 每次调整满意后立即保存
- 避免意外关闭窗口导致调整丢失
- 可以保存多个版本（手动备份JSON文件）
```

---

## 🎯 最佳实践

### 推荐工作流程

```
1. 打开预览窗口
   ↓
2. 确认"锁定视图"已勾选
   ↓
3. 选择第一个调整对象（如：色带）
   ↓
4. 使用"大"步长快速移动
   ↓
5. 使用"小"步长精细调整
   ↓
6. 保存位置设置
   ↓
7. 切换到下一个对象（如：比例尺）
   ↓
8. 重复步骤4-6
   ↓
9. 所有对象调整完成后
   ↓
10. 保存图片
```

### 调整顺序建议

```
推荐顺序：
1. 色带位置（最重要）
2. 比例尺位置
3. 北箭位置

原因：
- 色带通常最显眼，优先调整
- 比例尺次之
- 北箭通常位置固定，最后调整
```

---

## 📊 功能对比

| 功能 | 旧版本 | 新版本 |
|------|--------|--------|
| 操作方式 | 仅键盘 | 按钮+键盘 |
| 步长控制 | 固定/Shift | 小/中/大可选 |
| 操作反馈 | 无 | 完整反馈系统 |
| 视图控制 | 无 | 锁定+恢复 |
| 缩放问题 | 经常出现 | 基本解决 |
| 易用性 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## 🎉 总结

新界面提供了：
- ✅ **更直观的操作** - GUI按钮，无需记忆快捷键
- ✅ **更可靠的体验** - 视图锁定，防止意外缩放
- ✅ **更清晰的反馈** - 每个操作都有明确提示
- ✅ **更灵活的控制** - 多种步长，精确调整

**开始使用新界面，享受更好的体验！** 🚀

