# 更新日志 (Changelog)

## [v13] - 2025-10-29

### ✨ 新增功能

#### 1. 色带宽度调整功能
- **单图页面**: 新增"宽度比例"参数，可精确控制色带宽度（默认0.15）
- **多图页面**: 优化共享和分图色带的宽度控制
  - 共享色带宽度比例（默认0.10）
  - 分图色带宽度比例（默认0.15）
- 添加工具提示，帮助用户理解参数含义

#### 2. 新增GUI组件
- `CollapsibleFrame`: 可折叠面板组件，为未来界面优化提供基础

### 🎨 界面优化

#### 单图页面
- 重新组织"色带（单图）"区域的参数布局
- 参数分组更加清晰：
  - 第一行：位置、宽度比例、与图距、标签文本
  - 第二行：标签字号、刻度字号、色阶上限

#### 多图页面
- 优化"色带选项"区域的布局
- 统一参数命名（从"厚度%"改为"宽度比例"）
- 调整参数排列顺序，使相关参数更加集中

### 🔧 技术改进

#### 修改的文件
1. **gui_widgets.py**
   - 新增 `CollapsibleFrame` 类（30-81行）
   - 支持可折叠/展开的面板容器

2. **plotting.py**
   - 更新 `_make_single_map_impl` 函数签名
   - 新增 `cbar_fraction` 参数（默认0.15）
   - 在色带创建时使用 `fraction` 参数控制宽度

3. **gui_app.py**
   - 单图页面：
     - 替换 `e_cbw` 为 `e_cbfrac1`
     - 更新预览函数（添加 `cbar_fraction` 参数）
     - 更新导出函数（添加 `cbar_fraction` 参数）
   - 多图页面：
     - 替换 `e_per_size` 为 `e_per_frac`
     - 优化色带选项区域布局
     - 添加工具提示
   - 更新参数注册字典
   - 更新默认值字典

#### 参数变更
| 旧参数 | 新参数 | 类型变化 | 默认值 |
|--------|--------|---------|--------|
| `e_cbw` | `e_cbfrac1` | 百分比 → 比例 | 0.15 |
| `e_per_size` | `e_per_frac` | 百分比 → 比例 | 0.15 |
| - | `cbar_fraction` | 新增 | 0.15 |

### 📝 文档更新

新增以下文档：
- `IMPROVEMENTS.md` - 详细的改进说明
- `QUICK_GUIDE.md` - 快速使用指南
- `CHANGELOG.md` - 更新日志（本文件）
- `test_gui.py` - 测试脚本

### ✅ 兼容性

- ✅ 完全向后兼容
- ✅ 所有原有功能保持不变
- ✅ 状态文件自动迁移
- ✅ 默认值调整不影响现有使用

### 🐛 修复

- 修复了色带宽度参数命名不一致的问题
- 统一了单图和多图的参数命名规范

### 📊 代码统计

- 修改文件数: 3
- 新增文件数: 4
- 新增代码行数: ~150行
- 修改代码行数: ~50行
- 新增组件数: 1 (CollapsibleFrame)

---

## [v12] - 之前版本

### 功能
- 单图和多图绘制
- 色带自定义
- 比例尺和北箭
- 多种配色方案
- 叠加图层支持
- 状态保存/恢复
- 预览功能
- PNG/PDF导出

---

## 升级说明

### 从 v12 升级到 v13

1. **无需手动操作**
   - 直接运行新版本即可
   - 旧的参数设置会自动迁移

2. **参数调整建议**
   - 如果之前使用了自定义的色带宽度，建议重新调整
   - 新的"宽度比例"参数更加直观和精确

3. **测试建议**
   - 运行 `test_gui.py` 测试新功能
   - 使用"预览"功能检查色带宽度效果
   - 确认导出的图片符合预期

---

## 已知问题

目前没有已知问题。

---

## 计划中的功能

### v14 (计划中)
- [ ] 使用折叠面板重构整个界面
- [ ] 参数预设功能
- [ ] 实时预览优化
- [ ] 批量处理功能
- [ ] 更多配色方案

### v15 (计划中)
- [ ] 插件系统
- [ ] 自定义叠加图层编辑器
- [ ] 图例编辑器
- [ ] 导出模板功能

---

## 反馈

如有问题或建议，请：
1. 记录使用过程中的问题
2. 提出改进建议
3. 分享使用经验

---

**感谢使用！** 🎉

