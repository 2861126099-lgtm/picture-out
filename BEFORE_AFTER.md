# 修改前后对比

## 单图页面 - 色带区域

### 修改前 (v12)
```
┌─────────────────────────────────────────────────────────────┐
│ 色带（单图）                                                 │
├─────────────────────────────────────────────────────────────┤
│ 位置: [right ▼]  厚度%: [1.6]  与图距: [0.02]              │
│ 标签文本: [________________]                                │
│ 标签字号/刻度字号: [11] [10]                                │
│ 色阶上限(空=自动): [____]                                   │
└─────────────────────────────────────────────────────────────┘
```

**问题**:
- "厚度%"参数名称不够直观
- 参数排列不够紧凑
- 缺少参数说明

### 修改后 (v13)
```
┌─────────────────────────────────────────────────────────────┐
│ 色带（单图）                                                 │
├─────────────────────────────────────────────────────────────┤
│ 位置: [right ▼]  宽度比例: [0.15] (?)  与图距: [0.02]      │
│ 标签文本: [________________]                                │
│                                                              │
│ 标签字号/刻度字号: [11] [10]  色阶上限(空=自动): [____]    │
└─────────────────────────────────────────────────────────────┘
```

**改进**:
- ✅ 参数名称更加直观（"宽度比例"）
- ✅ 参数排列更加合理
- ✅ 添加了工具提示 (?)
- ✅ 相关参数集中在同一行

---

## 多图页面 - 色带选项

### 修改前 (v12)
```
┌─────────────────────────────────────────────────────────────┐
│ 色带选项                                                     │
├─────────────────────────────────────────────────────────────┤
│ ☑ 使用共享色带（取消则每幅各自一条）                        │
│                                                              │
│ 共享：位置/厚度占比/刻度数                                   │
│ [right ▼] [0.10] [6]                                        │
│ 共享：标签文本/字号/刻度字号                                 │
│ [________] [11] [10]                                         │
│ 共享：色阶上限（空=自动）[____]                              │
│                                                              │
│ 分图：位置/厚度%/与图距                                      │
│ [right ▼] [1.6] [0.02]                                      │
│ 分图：上限百分位(%) [100]  刻度个数 [6]                     │
│ 分图：标签文本/字号/刻度字号                                 │
│ [________] [11] [10]                                         │
└─────────────────────────────────────────────────────────────┘
```

**问题**:
- 共享色带用"厚度占比"，分图用"厚度%"，命名不统一
- 参数分散在多行，不够紧凑
- 缺少参数说明

### 修改后 (v13)
```
┌─────────────────────────────────────────────────────────────┐
│ 色带选项                                                     │
├─────────────────────────────────────────────────────────────┤
│ ☑ 使用共享色带（取消则每幅各自一条）                        │
│                                                              │
│ 共享：位置/宽度比例/刻度数                                   │
│ [right ▼] [0.10] (?) [6]                                    │
│ 标签文本/字号/刻度字号  色阶上限（空=自动）                  │
│ [________] [11] [10]  [____]                                 │
│                                                              │
│ 分图：位置/宽度比例/与图距                                   │
│ [right ▼] [0.15] (?) [0.02]                                 │
│ 上限百分位(%) [100]  刻度个数 [6]                           │
│ 分图：标签文本/字号/刻度字号                                 │
│ [________] [11] [10]                                         │
└─────────────────────────────────────────────────────────────┘
```

**改进**:
- ✅ 统一使用"宽度比例"命名
- ✅ 参数排列更加紧凑
- ✅ 添加了工具提示 (?)
- ✅ 相关参数集中显示
- ✅ 去掉了重复的"共享："前缀

---

## 参数对比

### 单图色带宽度

| 版本 | 参数名 | 输入值 | 实际含义 | 默认值 |
|------|--------|--------|----------|--------|
| v12 | 厚度% | 1.6 | 不明确 | 1.6 |
| v13 | 宽度比例 | 0.15 | 占图宽度的15% | 0.15 |

### 多图共享色带宽度

| 版本 | 参数名 | 输入值 | 实际含义 | 默认值 |
|------|--------|--------|----------|--------|
| v12 | 厚度占比 | 0.10 | 占图宽度的10% | 0.10 |
| v13 | 宽度比例 | 0.10 | 占图宽度的10% | 0.10 |

### 多图分图色带宽度

| 版本 | 参数名 | 输入值 | 实际含义 | 默认值 |
|------|--------|--------|----------|--------|
| v12 | 厚度% | 1.6 | 不明确 | 1.6 |
| v13 | 宽度比例 | 0.15 | 占图宽度的15% | 0.15 |

---

## 代码对比

### gui_app.py - 单图色带区域

#### 修改前
```python
C1 = ttk.LabelFrame(page1, text="色带（单图）")
ttk.Label(C1, text="位置").grid(row=0, column=0, sticky="e")
cb_loc1 = ttk.Combobox(C1, values=["right","left","top","bottom"], width=8, state="readonly")
cb_loc1.set("right"); cb_loc1.grid(row=0, column=1, sticky="w")
ttk.Label(C1, text="厚度%").grid(row=0, column=2, sticky="e")
e_cbw = tk.Entry(C1, width=6); e_cbw.insert(0, "1.6"); e_cbw.grid(row=0, column=3, sticky="w")
```

#### 修改后
```python
C1 = ttk.LabelFrame(page1, text="色带（单图）")
C1.grid(row=2, column=0, padx=6, pady=6, sticky="we")

# 第一行：位置、宽度比例、与图距、标签文本
ttk.Label(C1, text="位置").grid(row=0, column=0, sticky="e")
cb_loc1 = ttk.Combobox(C1, values=["right","left","top","bottom"], width=8, state="readonly")
cb_loc1.set("right"); cb_loc1.grid(row=0, column=1, sticky="w")

ttk.Label(C1, text="宽度比例").grid(row=0, column=2, sticky="e")
e_cbfrac1 = tk.Entry(C1, width=6); e_cbfrac1.insert(0, "0.15"); e_cbfrac1.grid(row=0, column=3, sticky="w")
qmark(C1, "色带宽度占整个图的比例，范围0.05-0.3，默认0.15", 0, 4)
```

### plotting.py - 函数签名

#### 修改前
```python
def _make_single_map_impl(
    tif_path, border_shp, overlay_layers=None,
    year_start=1981, year_end=2020, as_yearly=False,
    font_en="Arial", font_zh="SimHei",
    # ... 其他参数 ...
):
```

#### 修改后
```python
def _make_single_map_impl(
    tif_path, border_shp, overlay_layers=None,
    year_start=1981, year_end=2020, as_yearly=False,
    font_en="Arial", font_zh="SimHei",
    cbar_fraction=0.15,  # 新增：色带宽度比例
    # ... 其他参数 ...
):
```

---

## 视觉效果对比

### 色带宽度效果

#### 宽度比例 = 0.10
```
┌──────────────────┬─┐
│                  │█│  ← 较窄的色带
│                  │█│
│    主图区域      │█│
│                  │█│
│                  │█│
└──────────────────┴─┘
```

#### 宽度比例 = 0.15 (默认)
```
┌──────────────────┬──┐
│                  │██│  ← 标准宽度
│                  │██│
│    主图区域      │██│
│                  │██│
│                  │██│
└──────────────────┴──┘
```

#### 宽度比例 = 0.20
```
┌──────────────────┬───┐
│                  │███│  ← 较宽的色带
│                  │███│
│    主图区域      │███│
│                  │███│
│                  │███│
└──────────────────┴───┘
```

---

## 总结

### 主要改进点

1. **参数命名统一化**
   - 统一使用"宽度比例"
   - 更加直观和专业

2. **界面布局优化**
   - 相关参数集中显示
   - 减少视觉混乱
   - 提高操作效率

3. **用户体验提升**
   - 添加工具提示
   - 参数说明更清晰
   - 降低学习成本

4. **代码质量提升**
   - 参数命名更规范
   - 代码结构更清晰
   - 易于维护和扩展

### 兼容性保证

- ✅ 所有原有功能完全保留
- ✅ 参数自动迁移
- ✅ 默认值保持合理
- ✅ 无需手动调整

---

**升级建议**: 直接使用新版本，无需担心兼容性问题！

